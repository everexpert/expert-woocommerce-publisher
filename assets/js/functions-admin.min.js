!function($){"use strict";var media_uploader=null,$systemStatusBtn;function open_media_uploader_image(event,imageSelectorButton){var $imageSelectorScope=imageSelectorButton.parent();(media_uploader=wp.media({frame:"post",state:"insert",multiple:!1})).on("insert",(function(){var json=media_uploader.state().get("selection").first().toJSON(),image_id=json.id,image_url,image_html='<img src="'+json.url+'" width="90" height="90">',current_selector="";switch(event.target.id){case"ewp_publisher_image_select":current_selector=".taxonomy-ewp-publisher #ewp_publisher_image";break;case"ewp_publisher_banner_select":current_selector=".taxonomy-ewp-publisher #ewp_publisher_banner"}$(current_selector).val(image_id),$(current_selector+"_result").remove(),$(".ewp_publisher_image_selected",$imageSelectorScope).length?$(".ewp_publisher_image_selected span",$imageSelectorScope).html(image_html):$imageSelectorScope.append('<div class="ewp_publisher_image_selected"><span>'+image_html+"</span></div>"),add_delete_link($imageSelectorScope)})),media_uploader.open()}function add_delete_link($imageSelectorScope){$(".ewp_publisher_image_selected span",$imageSelectorScope).append('<a href="#" class="ewp_publisher_image_selected_remove">X</a>'),$(".ewp_publisher_image_selected_remove",$imageSelectorScope).on("click",(function(event){event.preventDefault(),$(this).closest(".ewp_publisher_image_selected").remove(),$("#ewp_publisher_image",$imageSelectorScope).val(""),$("#ewp_publisher_banner",$imageSelectorScope).val("")}))}function ewpBindEventsToWigets(widget){var $currentWidget=$(".ewp-select-display-as");null!=widget&&($currentWidget=$(".ewp-select-display-as",widget)),$currentWidget.on("change",(function(){"publisher_logo"==$(this).val()?$(this).parent().siblings(".ewp-display-as-logo").addClass("show"):$(this).parent().siblings(".ewp-display-as-logo").removeClass("show")}))}$(".taxonomy-ewp-publisher #ewp_publisher_image_select, .taxonomy-ewp-publisher #ewp_publisher_banner_select").on("click",(function(event){open_media_uploader_image(event,$(this))})),$(".taxonomy-ewp-publisher #ewp_publisher_image_select, .taxonomy-ewp-publisher #ewp_publisher_banner_select").each((function(){add_delete_link($(this).parent())})),$("body").hasClass("edit-tags-php")&&$("body").hasClass("taxonomy-ewp-publisher")&&$(document).ajaxSuccess((function(event,xhr,settings){void 0!==settings&&settings.data&&~settings.data.indexOf("action=add-tag")&&~settings.data.indexOf("taxonomy=ewp-publisher")&&($("#ewp_publisher_image").val(""),$("#ewp_publisher_banner").val(""),$(".ewp_publisher_image_selected").remove())})),$(".taxonomy-ewp-publisher table .column-featured > span").not("ewp-blocked").on("click",(function(e){e.preventDefault();var $currentStar=$(this);$currentStar.addClass("ewp-blocked"),$currentStar.hasClass("dashicons-star-filled")?($currentStar.removeClass("dashicons-star-filled"),$currentStar.addClass("dashicons-star-empty")):($currentStar.removeClass("dashicons-star-empty"),$currentStar.addClass("dashicons-star-filled"));var data={action:"ewp_admin_set_featured_publisher",publisher:$currentStar.data("publisher-id")};$.post(ewp_ajax_object_admin.ajax_url,data,(function(response){if($currentStar.removeClass("ewp-blocked"),response.success){var $featuredCount=$(".taxonomy-ewp-publisher .ewp-featured-count > span");"up"==response.data.direction?$featuredCount.html(parseInt($featuredCount.text())+1):$featuredCount.html(parseInt($featuredCount.text())-1)}else alert(response.data.error_msg)}))})),$(".taxonomy-ewp-publisher #ewp-first-featured-publishers").on("change",(function(e){e.preventDefault(),$("#screen-options-apply").replaceWith('<img src="'+ewp_ajax_object_admin.site_url+'/wp-admin/images/loading.gif">');var data={action:"ewp_admin_save_screen_settings",new_val:$(this).is(":checked")};$.post(ewp_ajax_object_admin.ajax_url,data,(function(response){location.reload()}))})),$(".ewp-edit-publishers-bottom > span").on("click",(function(e){e.preventDefault(),$(".taxonomy-ewp-publisher #col-left").toggleClass("ewp-force-full-width"),$(".taxonomy-ewp-publisher #col-right").toggleClass("ewp-force-full-width")})),$(".ewp-admin-selectwoo").length&&$(".ewp-admin-selectwoo").selectWoo(),$("#wc_ewp_admin_tab_tools_migrate").on("change",(function(){if("-"!=$(this).val()&&confirm(ewp_ajax_object_admin.translations.migrate_notice)){$("html").append('<div class="ewp-modal"><div class="ewp-modal-inner"></div></div>'),$(".ewp-modal-inner").html("<p>"+ewp_ajax_object_admin.translations.migrating+"</p>");var data={action:"ewp_admin_migrate_publishers",from:$(this).val()};$.post(ewp_ajax_object_admin.ajax_url,data,(function(response){setTimeout((function(){location.href=ewp_ajax_object_admin.publishers_url}),1e3)}))}$(this).val("-")})),$("#wc_ewp_admin_tab_tools_dummy_data").on("change",(function(){if("-"!=$(this).val()&&confirm(ewp_ajax_object_admin.translations.dummy_data_notice)){$("html").append('<div class="ewp-modal"><div class="ewp-modal-inner"></div></div>'),$(".ewp-modal-inner").html("<p>"+ewp_ajax_object_admin.translations.dummy_data+"</p>");var data={action:"ewp_admin_dummy_data",from:$(this).val()};$.post(ewp_ajax_object_admin.ajax_url,data,(function(response){setTimeout((function(){location.href=ewp_ajax_object_admin.publishers_url}),1e3)}))}$(this).val("-")})),$("#wc_ewp_admin_tab_tools_system_status").siblings("p").addClass("button wc_ewp_admin_tab_status_btn"),$(".wc_ewp_admin_tab_status_btn").on("click",(function(e){if(e.preventDefault(),!$("#wc_ewp_admin_status_result").length){var $systemStatusTextarea=$("#wc_ewp_admin_tab_tools_system_status");$('<pre id="wc_ewp_admin_status_result"></pre>').insertAfter($systemStatusTextarea),$("#wc_ewp_admin_status_result").click((function(e){e.preventDefault();var refNode=$(this)[0],range;if($.browser.msie)(range=document.body.createTextRange()).moveToElementText(refNode),range.select();else if($.browser.mozilla||$.browser.opera){var selection=window.getSelection(),range;(range=document.createRange()).selectNodeContents(refNode),selection.removeAllRanges(),selection.addRange(range)}else if($.browser.safari){var selection;(selection=window.getSelection()).setBaseAndExtent(refNode,0,refNode,1)}}))}$("#wc_ewp_admin_status_result").html('<img src="'+ewp_ajax_object_admin.site_url+'/wp-admin/images/spinner.gif" alt="Loading" height="20" width="20">'),$("#wc_ewp_admin_status_result").show();var data={action:"ewp_system_status"};$.post(ajaxurl,data,(function(response){$("#wc_ewp_admin_status_result").html(response),$("#wc_ewp_admin_status_result").trigger("click")}))})),$(document).on("click",".ewp-notice-dismissible .notice-dismiss",(function(e){e.preventDefault();var noticeName,data={action:"dismiss_ewp_notice",notice_name:$(this).closest(".ewp-notice-dismissible").data("notice")};$.post(ajaxurl,data,(function(response){}))})),ewpBindEventsToWigets(),$(document).bind("widget-added",(function(e,widget){ewpBindEventsToWigets(widget)})),$(document).on("widget-updated",(function(e,widget){ewpBindEventsToWigets(widget)})),$("button.ewp-publishers-export").on("click",(function(e){e.preventDefault();var $clickedBtn=$(this);$clickedBtn.addClass("ewp-loading-overlay"),$clickedBtn.prop("disabled",!0);var data={action:"ewp_publishers_export"};$.post(ewp_ajax_object_admin.ajax_url,data,(function(response){if(response.success){$clickedBtn.removeClass("ewp-loading-overlay"),$clickedBtn.prop("disabled",!1),$("#ewp-download-export-file").remove();var link=document.createElement("a");link.download="publishers.json",link.id="ewp-download-export-file",link.href=response.data.export_file_url,$("body").append(link),link.click()}}))})),$("button.ewp-publishers-import").on("click",(function(e){e.preventDefault(),$("input.ewp-publishers-import-file").trigger("click")})),$("input.ewp-publishers-import-file").on("change",(function(e){e.preventDefault();var $clickedBtn=$("button.ewp-publishers-import");$clickedBtn.addClass("ewp-loading-overlay"),$clickedBtn.prop("disabled",!0);var file=$(this)[0].files[0],reqData=new FormData;reqData.append("action","ewp_publishers_import"),reqData.append("file",file),$.ajax({url:ewp_ajax_object_admin.ajax_url,type:"post",cache:!1,dataType:"json",contentType:!1,processData:!1,data:reqData,success:function(resp){resp.success?($clickedBtn.removeClass("ewp-loading-overlay"),location.reload()):alert("Importer error")}})}))}(jQuery);